<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hangul Learning Tool</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #eee;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
        }
        .tab-content {
            display: none;
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 0 0 5px 5px;
        }
        .tab-content.active {
            display: block;
        }
        .hangul-chart {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .hangul-card {
            padding: 15px;
            text-align: center;
            background-color: #f0f8ff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        .hangul-char {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }
        .pronunciation {
            font-weight: bold;
            color: #2c3e50;
        }
        .char-name {
            font-style: italic;
            color: #666;
            font-size: 0.9rem;
            margin: 5px 0;
        }
        .audio-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 5px;
            width: 100%;
        }
        .audio-btn:hover {
            background-color: #2980b9;
        }
        .flashcard-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }
        .flashcard {
            width: 300px;
            height: 250px;
            perspective: 1000px;
            margin-bottom: 20px;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .flashcard-front {
            background-color: #e74c3c;
            color: white;
        }
        .flashcard-back {
            background-color: #2ecc71;
            color: white;
            transform: rotateY(180deg);
        }
        .flashcard-char {
            font-size: 4rem;
            margin-bottom: 10px;
        }
        .flashcard-pronunciation {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        .flashcard-name {
            font-style: italic;
            margin-bottom: 10px;
        }
        .flashcard-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .control-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            min-width: 80px;
        }
        .again-btn {
            background-color: #e74c3c;
            color: white;
        }
        .good-btn {
            background-color: #f39c12;
            color: white;
        }
        .easy-btn {
            background-color: #2ecc71;
            color: white;
        }
        .practice-container {
            margin-top: 20px;
        }
        .practice-display {
            font-size: 2rem;
            text-align: center;
            margin: 20px 0;
            min-height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }
        .practice-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .practice-btn {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .difficulty-selector {
            margin-top: 20px;
            text-align: center;
        }
        .progress-container {
            margin-top: 30px;
            background-color: #eee;
            border-radius: 5px;
            padding: 10px;
        }
        .progress-bar {
            height: 20px;
            background-color: #3498db;
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s;
        }
        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        .memorized-toggle {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #ccc;
        }
        .memorized-toggle.memorized {
            color: #2ecc71;
        }
        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .stat-box {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
            margin: 5px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        .batch-selector {
            margin: 20px 0;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 8px;
        }
        .batch-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .batch-option {
            display: flex;
            align-items: center;
        }
        .start-batch-btn {
            margin-top: 10px;
            padding: 8px 15px;
            background-color: #9b59b6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .current-batch-info {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
        .memorize-btn {
            background-color: #9b59b6;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .hint-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        .batch-selection {
            margin-top: 15px;
        }
        .batch-group {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        .batch-group h4 {
            margin-top: 0;
        }
        .batch-btn {
            padding: 5px 10px;
            margin: 3px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .batch-btn.active {
            background-color: #2ecc71;
        }
    </style>
</head>
<body>
    <h1>Korean Hangul Learning Tool</h1>
    
    <div class="tab-container">
        <div class="tab active" onclick="openTab('chart')">Hangul Chart</div>
        <div class="tab" onclick="openTab('flashcards')">Flashcards</div>
        <div class="tab" onclick="openTab('practice')">Reading Practice</div>
        <div class="tab" onclick="openTab('progress')">My Progress</div>
    </div>
    
    <div id="chart" class="tab-content active">
        <h2>Hangul Characters</h2>
        
        <h3>Consonants (자음)</h3>
        <div class="hangul-chart" id="consonants-chart"></div>
        
        <h3>Vowels (모음)</h3>
        <div class="hangul-chart" id="vowels-chart"></div>
        
        <h3>Basic Syllables</h3>
        <div class="hangul-chart" id="syllables-chart"></div>
    </div>
    
    <div id="flashcards" class="tab-content">
        <h2>Spaced Repetition Flashcards</h2>
        
        <div class="batch-selector">
            <h3>Select Batch to Learn</h3>
            <div class="batch-options">
                <div class="batch-option">
                    <input type="checkbox" id="batch-consonants" checked>
                    <label for="batch-consonants">Consonants</label>
                </div>
                <div class="batch-option">
                    <input type="checkbox" id="batch-vowels" checked>
                    <label for="batch-vowels">Vowels</label>
                </div>
                <div class="batch-option">
                    <input type="checkbox" id="batch-syllables">
                    <label for="batch-syllables">Syllables</label>
                </div>
            </div>
            
            <div class="batch-selection" id="batch-selection">
                <!-- Batch groups will be inserted here -->
            </div>
            
            <div class="current-batch-info" id="current-batch-info">No active batch</div>
        </div>
        
        <div class="flashcard-container">
            <div class="flashcard" id="flashcard" onclick="flipCard()">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div class="flashcard-char" id="flashcard-front-char">ㄱ</div>
                        <div>Click to flip</div>
                    </div>
                    <div class="flashcard-back">
                        <div class="flashcard-char" id="flashcard-back-char">ㄱ</div>
                        <div class="flashcard-pronunciation" id="flashcard-pronunciation">Sound: g/k</div>
                        <div class="flashcard-name" id="flashcard-name">Name: 기역 (giyeok)</div>
                        <button class="audio-btn" onclick="playCurrentAudio(event)">Play Sound</button>
                        <button class="hint-btn" onclick="showHint(event)">Show Hint</button>
                        <button class="memorize-btn" onclick="toggleMemorizedFromFlashcard(event)">I Know This</button>
                    </div>
                </div>
            </div>
            
            <div class="flashcard-controls">
                <button class="control-btn again-btn" onclick="rateCard(0, event)">Again</button>
                <button class="control-btn good-btn" onclick="rateCard(1, event)">Good</button>
                <button class="control-btn easy-btn" onclick="rateCard(2, event)">Easy</button>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
            <div class="progress-text" id="progress-text">0/0 reviewed</div>
        </div>
    </div>
    
    <div id="practice" class="tab-content">
        <h2>Reading Practice</h2>
        <p>Generate random Korean words and sentences to practice reading.</p>
        
        <div class="difficulty-selector">
            <label for="difficulty">Difficulty:</label>
            <select id="difficulty" onchange="updateDifficulty()">
                <option value="basic">Basic Characters</option>
                <option value="words">Simple Words</option>
                <option value="sentences">Short Sentences</option>
            </select>
            
            <div id="basic-options" style="margin-top: 10px;">
                <label>Character Types:</label>
                <div>
                    <input type="checkbox" id="practice-consonants" checked>
                    <label for="practice-consonants">Consonants</label>
                </div>
                <div>
                    <input type="checkbox" id="practice-vowels" checked>
                    <label for="practice-vowels">Vowels</label>
                </div>
                <div>
                    <input type="checkbox" id="practice-syllables">
                    <label for="practice-syllables">Syllables</label>
                </div>
            </div>
        </div>
        
        <div class="practice-container">
            <div class="practice-display" id="practice-display">Press "Generate" to start</div>
            
            <div class="practice-controls">
                <button class="practice-btn" onclick="generatePractice()">Generate</button>
                <button class="practice-btn" onclick="showAnswer()">Show Answer</button>
                <button class="practice-btn" onclick="playPracticeAudio()">Play Audio</button>
            </div>
            
            <div id="answer" style="text-align: center; margin-top: 20px; display: none;">
                <h3>Pronunciation/Translation</h3>
                <div id="answer-text"></div>
            </div>
        </div>
    </div>

    <div id="progress" class="tab-content">
        <h2>My Learning Progress</h2>
        
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-value" id="total-chars">0</div>
                <div class="stat-label">Total Characters</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="memorized-chars">0</div>
                <div class="stat-label">Memorized</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="mastered-chars">0</div>
                <div class="stat-label">Mastered</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="review-count">0</div>
                <div class="stat-label">Total Reviews</div>
            </div>
        </div>
        
        <h3>Memorized Characters</h3>
        <div class="hangul-chart" id="memorized-chart"></div>
        
        <h3>Characters to Review</h3>
        <div class="hangul-chart" id="review-chart"></div>
    </div>

    <script>
        // Hangul data with names and audio
        const hangulData = {
            consonants: [
                { char: 'ㄱ', pron: 'g/k', name: '기역 (giyeok)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3f/Ko-%E3%84%B1.oga' },
                { char: 'ㄴ', pron: 'n', name: '니은 (nieun)', audio: 'https://upload.wikimedia.org/wikipedia/commons/4/4e/Ko-%E3%84%B4.oga' },
                { char: 'ㄷ', pron: 'd/t', name: '디귿 (digeut)', audio: 'https://upload.wikimedia.org/wikipedia/commons/7/7a/Ko-%E3%84%B7.oga' },
                { char: 'ㄹ', pron: 'r/l', name: '리을 (rieul)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5b/Ko-%E3%84%B9.oga' },
                { char: 'ㅁ', pron: 'm', name: '미음 (mieum)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5f/Ko-%E3%85%81.oga' },
                { char: 'ㅂ', pron: 'b/p', name: '비읍 (bieup)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5e/Ko-%E3%85%82.oga' },
                { char: 'ㅅ', pron: 's', name: '시옷 (siot)', audio: 'https://upload.wikimedia.org/wikipedia/commons/2/2b/Ko-%E3%85%85.oga' },
                { char: 'ㅇ', pron: 'ng/-', name: '이응 (ieung)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Ko-%E3%85%87.oga' },
                { char: 'ㅈ', pron: 'j', name: '지읒 (jieut)', audio: 'https://upload.wikimedia.org/wikipedia/commons/8/8a/Ko-%E3%85%88.oga' },
                { char: 'ㅊ', pron: 'ch', name: '치읓 (chieut)', audio: 'https://upload.wikimedia.org/wikipedia/commons/4/4b/Ko-%E3%85%8A.oga' },
                { char: 'ㅋ', pron: 'k', name: '키읔 (kieuk)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6b/Ko-%E3%85%8B.oga' },
                { char: 'ㅌ', pron: 't', name: '티읕 (tieut)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3a/Ko-%E3%85%8C.oga' },
                { char: 'ㅍ', pron: 'p', name: '피읖 (pieup)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6e/Ko-%E3%85%8D.oga' },
                { char: 'ㅎ', pron: 'h', name: '히읗 (hieut)', audio: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Ko-%E3%85%8E.oga' },
                { char: 'ㄲ', pron: 'kk', name: '쌍기역 (ssanggiyeok)', audio: 'https://upload.wikimedia.org/wikipedia/commons/0/0b/Ko-%E3%84%B2.oga' },
                { char: 'ㄸ', pron: 'tt', name: '쌍디귿 (ssangdigeut)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Ko-%E3%84%B8.oga' },
                { char: 'ㅃ', pron: 'pp', name: '쌍비읍 (ssangbieup)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6d/Ko-%E3%85%83.oga' },
                { char: 'ㅆ', pron: 'ss', name: '쌍시옷 (ssangsiot)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Ko-%E3%85%86.oga' },
                { char: 'ㅉ', pron: 'jj', name: '쌍지읒 (ssangjieut)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3a/Ko-%E3%85%89.oga' }
            ],
            vowels: [
                { char: 'ㅏ', pron: 'a', name: '아 (a)', audio: 'https://upload.wikimedia.org/wikipedia/commons/9/9d/Ko-%E3%85%8F.oga' },
                { char: 'ㅑ', pron: 'ya', name: '야 (ya)', audio: 'https://upload.wikimedia.org/wikipedia/commons/1/1e/Ko-%E3%85%91.oga' },
                { char: 'ㅓ', pron: 'eo', name: '어 (eo)', audio: 'https://upload.wikimedia.org/wikipedia/commons/8/8e/Ko-%E3%85%93.oga' },
                { char: 'ㅕ', pron: 'yeo', name: '여 (yeo)', audio: 'https://upload.wikimedia.org/wikipedia/commons/2/2e/Ko-%E3%85%95.oga' },
                { char: 'ㅗ', pron: 'o', name: '오 (o)', audio: 'https://upload.wikimedia.org/wikipedia/commons/1/1f/Ko-%E3%85%97.oga' },
                { char: 'ㅛ', pron: 'yo', name: '요 (yo)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5f/Ko-%E3%85%9B.oga' },
                { char: 'ㅜ', pron: 'u', name: '우 (u)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6c/Ko-%E3%85%9C.oga' },
                { char: 'ㅠ', pron: 'yu', name: '유 (yu)', audio: 'https://upload.wikimedia.org/wikipedia/commons/8/8c/Ko-%E3%85%A0.oga' },
                { char: 'ㅡ', pron: 'eu', name: '으 (eu)', audio: 'https://upload.wikimedia.org/wikipedia/commons/4/4b/Ko-%E3%85%A1.oga' },
                { char: 'ㅣ', pron: 'i', name: '이 (i)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5e/Ko-%E3%85%A3.oga' },
                { char: 'ㅐ', pron: 'ae', name: '애 (ae)', audio: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Ko-%E3%85%90.oga' },
                { char: 'ㅒ', pron: 'yae', name: '얘 (yae)', audio: 'https://upload.wikimedia.org/wikipedia/commons/1/1e/Ko-%E3%85%92.oga' },
                { char: 'ㅔ', pron: 'e', name: '에 (e)', audio: 'https://upload.wikimedia.org/wikipedia/commons/9/9a/Ko-%E3%85%94.oga' },
                { char: 'ㅖ', pron: 'ye', name: '예 (ye)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3a/Ko-%E3%85%96.oga' },
                { char: 'ㅘ', pron: 'wa', name: '와 (wa)', audio: 'https://upload.wikimedia.org/wikipedia/commons/0/0b/Ko-%E3%85%98.oga' },
                { char: 'ㅙ', pron: 'wae', name: '왜 (wae)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5d/Ko-%E3%85%99.oga' },
                { char: 'ㅚ', pron: 'oe', name: '외 (oe)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6e/Ko-%E3%85%9A.oga' },
                { char: 'ㅝ', pron: 'wo', name: '워 (wo)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6e/Ko-%E3%85%9D.oga' },
                { char: 'ㅞ', pron: 'we', name: '웨 (we)', audio: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Ko-%E3%85%9E.oga' },
                { char: 'ㅟ', pron: 'wi', name: '위 (wi)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3c/Ko-%E3%85%9F.oga' },
                { char: 'ㅢ', pron: 'ui', name: '의 (ui)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6e/Ko-%E3%85%A2.oga' }
            ],
            syllables: [
                { char: '가', pron: 'ga', name: '가 (ga)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6c/Ko-가.oga' },
                { char: '나', pron: 'na', name: '나 (na)', audio: 'https://upload.wikimedia.org/wikipedia/commons/4/4a/Ko-나.oga' },
                { char: '다', pron: 'da', name: '다 (da)', audio: 'https://upload.wikimedia.org/wikipedia/commons/4/4d/Ko-다.oga' },
                { char: '라', pron: 'ra', name: '라 (ra)', audio: 'https://upload.wikimedia.org/wikipedia/commons/6/6e/Ko-라.oga' },
                { char: '마', pron: 'ma', name: '마 (ma)', audio: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Ko-마.oga' },
                { char: '바', pron: 'ba', name: '바 (ba)', audio: 'https://upload.wikimedia.org/wikipedia/commons/8/8c/Ko-바.oga' },
                { char: '사', pron: 'sa', name: '사 (sa)', audio: 'https://upload.wikimedia.org/wikipedia/commons/8/8e/Ko-사.oga' },
                { char: '아', pron: 'a', name: '아 (a)', audio: 'https://upload.wikimedia.org/wikipedia/commons/0/0b/Ko-아.oga' },
                { char: '자', pron: 'ja', name: '자 (ja)', audio: 'https://upload.wikimedia.org/wikipedia/commons/0/0f/Ko-자.oga' },
                { char: '차', pron: 'cha', name: '차 (cha)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3c/Ko-차.oga' },
                { char: '카', pron: 'ka', name: '카 (ka)', audio: 'https://upload.wikimedia.org/wikipedia/commons/7/7c/Ko-카.oga' },
                { char: '타', pron: 'ta', name: '타 (ta)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5e/Ko-타.oga' },
                { char: '파', pron: 'pa', name: '파 (pa)', audio: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Ko-파.oga' },
                { char: '하', pron: 'ha', name: '하 (ha)', audio: 'https://upload.wikimedia.org/wikipedia/commons/5/5e/Ko-하.oga' }
            ]
        };

        // Practice data
        const practiceData = {
            words: [
                { korean: "사과", pronunciation: "sa-gwa", meaning: "apple" },
                { korean: "학교", pronunciation: "hak-gyo", meaning: "school" },
                { korean: "친구", pronunciation: "chin-gu", meaning: "friend" },
                { korean: "가방", pronunciation: "ga-bang", meaning: "bag" },
                { korean: "의자", pronunciation: "ui-ja", meaning: "chair" },
                { korean: "책상", pronunciation: "chaek-sang", meaning: "desk" },
                { korean: "컴퓨터", pronunciation: "keom-pyu-teo", meaning: "computer" },
                { korean: "핸드폰", pronunciation: "haen-deu-pon", meaning: "cell phone" },
                { korean: "물", pronunciation: "mul", meaning: "water" },
                { korean: "불", pronunciation: "bul", meaning: "fire" },
                { korean: "나무", pronunciation: "na-mu", meaning: "tree" },
                { korean: "꽃", pronunciation: "kkot", meaning: "flower" },
                { korean: "강아지", pronunciation: "gang-a-ji", meaning: "puppy" },
                { korean: "고양이", pronunciation: "go-yang-i", meaning: "cat" },
                { korean: "사람", pronunciation: "sa-ram", meaning: "person" }
            ],
            sentences: [
                { korean: "안녕하세요", pronunciation: "an-nyeong-ha-se-yo", meaning: "Hello" },
                { korean: "감사합니다", pronunciation: "gam-sa-ham-ni-da", meaning: "Thank you" },
                { korean: "미안합니다", pronunciation: "mi-an-ham-ni-da", meaning: "I'm sorry" },
                { korean: "이름이 뭐예요?", pronunciation: "i-reu-mi mwo-ye-yo?", meaning: "What's your name?" },
                { korean: "저는 학생입니다", pronunciation: "jeo-neun hak-saeng-im-ni-da", meaning: "I am a student" },
                { korean: "한국어를 배워요", pronunciation: "han-gu-geo-reul bae-wo-yo", meaning: "I'm learning Korean" },
                { korean: "오늘 날씨 좋아요", pronunciation: "o-neul nal-ssi jo-a-yo", meaning: "The weather is nice today" },
                { korean: "배고파요", pronunciation: "bae-go-pa-yo", meaning: "I'm hungry" },
                { korean: "물 주세요", pronunciation: "mul ju-se-yo", meaning: "Water, please" },
                { korean: "얼마예요?", pronunciation: "eol-ma-ye-yo?", meaning: "How much is it?" },
                { korean: "화장실이 어디예요?", pronunciation: "hwa-jang-si-ri eo-di-ye-yo?", meaning: "Where is the bathroom?" },
                { korean: "좋아해요", pronunciation: "jo-a-hae-yo", meaning: "I like it" },
                { korean: "몰라요", pronunciation: "mol-la-yo", meaning: "I don't know" },
                { korean: "알겠습니다", pronunciation: "al-get-seum-ni-da", meaning: "I understand" },
                { korean: "도와주세요", pronunciation: "do-wa-ju-se-yo", meaning: "Please help me" }
            ]
        };

        // App state
        let currentCardIndex = 0;
        let cards = [];
        let cardQueue = [];
        let currentCard = null;
        let reviewCount = 0;
        let totalReviews = 0;
        let currentPracticeItem = null;
        let currentDifficulty = 'basic';
        let audio = new Audio();
        let currentBatch = [];
        let memorizedCards = JSON.parse(localStorage.getItem('memorizedCards')) || [];
        let audioEnabled = true;
        let allBatches = [];

        // Initialize the app
        window.onload = function() {
            renderHangulCharts();
            initializeFlashcards();
            updateProgressStats();
            
            // Check if audio is playable
            testAudio();
        };

        // Test if audio can be played
        function testAudio() {
            const testAudio = new Audio();
            testAudio.src = 'data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU...';
            testAudio.play().then(() => {
                audioEnabled = true;
            }).catch((e) => {
                audioEnabled = false;
                console.log("Audio playback is blocked by your browser:", e);
            });
        }

        // Tab navigation
        function openTab(tabName) {
            const tabs = document.getElementsByClassName('tab');
            const tabContents = document.getElementsByClassName('tab-content');
            
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
                tabContents[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add('active');
            
            if (tabName === 'flashcards') {
                updateProgress();
                updateBatchSelection();
            } else if (tabName === 'progress') {
                updateProgressStats();
                renderProgressCharts();
            }
        }

        // Render Hangul charts
        function renderHangulCharts() {
            renderChart('consonants-chart', hangulData.consonants);
            renderChart('vowels-chart', hangulData.vowels);
            renderChart('syllables-chart', hangulData.syllables);
        }

        function renderChart(chartId, data) {
            const chart = document.getElementById(chartId);
            chart.innerHTML = '';
            
            data.forEach(item => {
                const isMemorized = memorizedCards.includes(item.char);
                const card = document.createElement('div');
                card.className = 'hangul-card';
                card.innerHTML = `
                    <button class="memorized-toggle ${isMemorized ? 'memorized' : ''}" 
                            onclick="toggleMemorized('${item.char}', this)">
                        ${isMemorized ? '✓' : '○'}
                    </button>
                    <div class="hangul-char">${item.char}</div>
                    <div class="pronunciation">Sound: ${item.pron}</div>
                    <div class="char-name">${item.name}</div>
                    <button class="audio-btn" onclick="playAudio('${item.audio}', event)">Play Sound</button>
                `;
                chart.appendChild(card);
            });
        }

        // Progress charts
        function renderProgressCharts() {
            renderProgressChart('memorized-chart', memorizedCards);
            
            const toReview = cards.filter(card => 
                !memorizedCards.includes(card.char) && 
                (card.nextReview <= new Date() || card.repetitions === 0)
            ).map(card => card.char);
            
            renderProgressChart('review-chart', toReview);
        }

        function renderProgressChart(chartId, characters) {
            const chart = document.getElementById(chartId);
            chart.innerHTML = '';
            
            if (characters.length === 0) {
                chart.innerHTML = '<p>No characters in this category yet</p>';
                return;
            }
            
            characters.forEach(char => {
                const item = [...hangulData.consonants, ...hangulData.vowels, ...hangulData.syllables]
                    .find(c => c.char === char);
                if (item) {
                    const card = document.createElement('div');
                    card.className = 'hangul-card';
                    card.innerHTML = `
                        <div class="hangul-char">${item.char}</div>
                        <div class="pronunciation">Sound: ${item.pron}</div>
                        <div class="char-name">${item.name}</div>
                        <button class="audio-btn" onclick="playAudio('${item.audio}', event)">Play Sound</button>
                    `;
                    chart.appendChild(card);
                }
            });
        }

        // Audio functions
        function playAudio(audioUrl, event) {
            if (event) event.stopPropagation();
            if (!audioEnabled) return;
            
            // Stop any currently playing audio
            audio.pause();
            
            // Create new audio element with the URL
            audio = new Audio(audioUrl);
            
            // Play the audio
            audio.play().catch(e => {
                console.error("Audio playback failed:", e);
                // Fallback to using the Audio constructor directly if the above fails
                new Audio(audioUrl).play().catch(e => console.error("Fallback audio playback failed:", e));
            });
        }

        function playCurrentAudio(event) {
            if (event) event.stopPropagation();
            if (currentCard && currentCard.audio) {
                playAudio(currentCard.audio, event);
            }
        }

        function playPracticeAudio() {
            if (currentPracticeItem && currentPracticeItem.audio) {
                playAudio(currentPracticeItem.audio);
            }
        }

        // Memorization tracking
        function toggleMemorized(char, button) {
            const index = memorizedCards.indexOf(char);
            if (index === -1) {
                memorizedCards.push(char);
                if (button) {
                    button.classList.add('memorized');
                    button.innerHTML = '✓';
                }
            } else {
                memorizedCards.splice(index, 1);
                if (button) {
                    button.classList.remove('memorized');
                    button.innerHTML = '○';
                }
            }
            
            // Save to localStorage
            localStorage.setItem('memorizedCards', JSON.stringify(memorizedCards));
            
            // Update progress stats
            updateProgressStats();
            
            // If we're in flashcards and this is the current card, show next
            if (currentCard && currentCard.char === char && document.getElementById('flashcards').classList.contains('active')) {
                showNextCard();
            }
        }

        function toggleMemorizedFromFlashcard(event) {
            event.stopPropagation();
            if (currentCard) {
                toggleMemorized(currentCard.char);
            }
        }

        // Flashcard functions
        function initializeFlashcards() {
            // Combine all characters into one deck
            cards = [
                ...hangulData.consonants,
                ...hangulData.vowels,
                ...hangulData.syllables
            ].map((card, index) => ({
                ...card,
                id: index,
                nextReview: new Date(),
                interval: 1,
                repetitions: 0,
                ease: 2.5,
                batch: 0
            }));
            
            // Load from localStorage if available
            const savedCards = localStorage.getItem('cards');
            if (savedCards) {
                try {
                    const parsedCards = JSON.parse(savedCards);
                    // Merge with current cards to preserve any new characters
                    cards.forEach(card => {
                        const savedCard = parsedCards.find(c => c.id === card.id);
                        if (savedCard) {
                            Object.assign(card, savedCard);
                        }
                    });
                } catch (e) {
                    console.error("Failed to load saved cards:", e);
                }
            }
            
            totalReviews = cards.length;
            updateProgressStats();
            updateBatchSelection();
        }

        function updateBatchSelection() {
            // Get selected categories
            const includeConsonants = document.getElementById('batch-consonants').checked;
            const includeVowels = document.getElementById('batch-vowels').checked;
            const includeSyllables = document.getElementById('batch-syllables').checked;
            
            // Filter cards by selected categories
            let availableCards = cards.filter(card => {
                if (includeConsonants && hangulData.consonants.some(c => c.char === card.char)) return true;
                if (includeVowels && hangulData.vowels.some(c => c.char === card.char)) return true;
                if (includeSyllables && hangulData.syllables.some(c => c.char === card.char)) return true;
                return false;
            });
            
            // Filter out memorized cards
            availableCards = availableCards.filter(card => !memorizedCards.includes(card.char));
            
            // Group into batches of 5
            allBatches = [];
            for (let i = 0; i < availableCards.length; i += 5) {
                allBatches.push(availableCards.slice(i, i + 5));
            }
            
            // Update UI with batch selection
            const batchSelection = document.getElementById('batch-selection');
            batchSelection.innerHTML = '';
            
            if (allBatches.length === 0) {
                batchSelection.innerHTML = '<p>No batches available with current filters</p>';
                return;
            }
            
            allBatches.forEach((batch, index) => {
                const batchGroup = document.createElement('div');
                batchGroup.className = 'batch-group';
                
                const batchTitle = document.createElement('h4');
                batchTitle.textContent = `Batch ${index + 1}`;
                
                const batchChars = document.createElement('div');
                batchChars.textContent = batch.map(c => c.char).join(', ');
                
                const batchBtn = document.createElement('button');
                batchBtn.className = 'batch-btn';
                batchBtn.textContent = 'Practice This Batch';
                batchBtn.onclick = () => startSpecificBatch(index);
                
                batchGroup.appendChild(batchTitle);
                batchGroup.appendChild(batchChars);
                batchGroup.appendChild(batchBtn);
                batchSelection.appendChild(batchGroup);
            });
        }

        function startSpecificBatch(batchIndex) {
            if (batchIndex >= 0 && batchIndex < allBatches.length) {
                currentBatch = [...allBatches[batchIndex]];
                cardQueue = [...currentBatch];
                
                // Update UI
                document.getElementById('current-batch-info').textContent = 
                    `Current batch: ${currentBatch.length} characters (${currentBatch.map(c => c.char).join(', ')})`;
                
                // Start with first card in batch
                showNextCard();
            }
        }

        function showNextCard() {
            // If queue is empty, refill with current batch
            if (cardQueue.length === 0) {
                cardQueue = [...currentBatch];
            }
            
            // Get next card from queue
            currentCard = cardQueue.shift();
            
            // Update UI
            document.getElementById('flashcard').classList.remove('flipped');
            document.getElementById('flashcard-front-char').textContent = currentCard.char;
            document.getElementById('flashcard-back-char').textContent = currentCard.char;
            document.getElementById('flashcard-pronunciation').textContent = `Sound: ${currentCard.pron}`;
            document.getElementById('flashcard-name').textContent = `Name: ${currentCard.name}`;
            
            updateProgress();
            
            // Auto-play audio if enabled
            if (audioEnabled && currentCard.audio) {
                setTimeout(() => playCurrentAudio(), 300);
            }
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
        }

        function showHint(event) {
            event.stopPropagation();
            if (!currentCard) return;
            
            const hint = `Hint: ${currentCard.pron}`;
            document.getElementById('flashcard-pronunciation').textContent = hint;
            
            // Reset to original after 2 seconds
            setTimeout(() => {
                if (document.getElementById('flashcard-pronunciation').textContent === hint) {
                    document.getElementById('flashcard-pronunciation').textContent = `Sound: ${currentCard.pron}`;
                }
            }, 2000);
        }

        function rateCard(rating, event) {
            if (event) event.stopPropagation();
            
            if (!currentCard) return;
            
            // Update card statistics based on rating
            const cardIndex = cards.findIndex(c => c.id === currentCard.id);
            if (cardIndex === -1) return;
            
            const card = cards[cardIndex];
            
            // SM-2 algorithm for spaced repetition
            if (rating === 0) { // Again
                card.repetitions = 0;
                card.interval = 1;
            } else { // Good or Easy
                card.repetitions += 1;
                
                if (card.repetitions === 1) {
                    card.interval = 1;
                } else if (card.repetitions === 2) {
                    card.interval = 6;
                } else {
                    card.interval = Math.round(card.interval * card.ease);
                }
                
                // Adjust ease factor
                if (rating === 1) { // Good
                    card.ease = Math.max(1.3, card.ease - 0.15);
                } else if (rating === 2) { // Easy
                    card.ease = Math.min(2.5, card.ease + 0.15);
                }
            }
            
            // Calculate next review date
            const now = new Date();
            const daysInMs = card.interval * 24 * 60 * 60 * 1000;
            card.nextReview = new Date(now.getTime() + daysInMs);
            
            // Update review count
            reviewCount++;
            totalReviews++;
            
            // Save to localStorage
            localStorage.setItem('cards', JSON.stringify(cards));
            localStorage.setItem('reviewCount', reviewCount.toString());
            localStorage.setItem('totalReviews', totalReviews.toString());
            
            // Show next card
            showNextCard();
        }

        function updateProgress() {
            const totalInBatch = currentBatch.length;
            const remaining = cardQueue.length;
            const reviewed = totalInBatch - remaining;
            
            const progressPercent = (reviewed / totalInBatch) * 100;
            document.getElementById('progress-bar').style.width = `${progressPercent}%`;
            document.getElementById('progress-text').textContent = `${reviewed}/${totalInBatch} reviewed`;
        }

        // Practice functions
        function updateDifficulty() {
            currentDifficulty = document.getElementById('difficulty').value;
            const basicOptions = document.getElementById('basic-options');
            basicOptions.style.display = currentDifficulty === 'basic' ? 'block' : 'none';
        }

        function generatePractice() {
            document.getElementById('answer').style.display = 'none';
            
            if (currentDifficulty === 'basic') {
                // Get selected character types
                const includeConsonants = document.getElementById('practice-consonants').checked;
                const includeVowels = document.getElementById('practice-vowels').checked;
                const includeSyllables = document.getElementById('practice-syllables').checked;
                
                // Filter characters based on selection
                let practiceChars = [];
                if (includeConsonants) practiceChars = practiceChars.concat(hangulData.consonants);
                if (includeVowels) practiceChars = practiceChars.concat(hangulData.vowels);
                if (includeSyllables) practiceChars = practiceChars.concat(hangulData.syllables);
                
                if (practiceChars.length === 0) {
                    document.getElementById('practice-display').textContent = "Please select at least one character type";
                    return;
                }
                
                // Random character from selected types
                const randomChar = practiceChars[Math.floor(Math.random() * practiceChars.length)];
                currentPracticeItem = {
                    korean: randomChar.char,
                    pronunciation: randomChar.pron,
                    name: randomChar.name,
                    audio: randomChar.audio
                };
                document.getElementById('practice-display').textContent = randomChar.char;
            } else if (currentDifficulty === 'words') {
                // Random word
                const randomWord = practiceData.words[Math.floor(Math.random() * practiceData.words.length)];
                currentPracticeItem = randomWord;
                document.getElementById('practice-display').textContent = randomWord.korean;
            } else {
                // Random sentence
                const randomSentence = practiceData.sentences[Math.floor(Math.random() * practiceData.sentences.length)];
                currentPracticeItem = randomSentence;
                document.getElementById('practice-display').textContent = randomSentence.korean;
            }
        }

        function showAnswer() {
            if (!currentPracticeItem) return;
            
            const answerDiv = document.getElementById('answer');
            const answerText = document.getElementById('answer-text');
            
            if (currentDifficulty === 'basic') {
                answerText.innerHTML = `
                    <p><strong>Name:</strong> ${currentPracticeItem.name}</p>
                    <p><strong>Pronunciation:</strong> ${currentPracticeItem.pronunciation}</p>
                `;
            } else {
                answerText.innerHTML = `
                    <p><strong>Pronunciation:</strong> ${currentPracticeItem.pronunciation}</p>
                    <p><strong>Meaning:</strong> ${currentPracticeItem.meaning}</p>
                `;
            }
            
            answerDiv.style.display = 'block';
        }

        // Progress functions
        function updateProgressStats() {
            const totalChars = cards.length;
            const memorizedChars = memorizedCards.length;
            const masteredChars = cards.filter(card => 
                memorizedCards.includes(card.char) && 
                card.repetitions >= 3
            ).length;
            
            document.getElementById('total-chars').textContent = totalChars;
            document.getElementById('memorized-chars').textContent = memorizedChars;
            document.getElementById('mastered-chars').textContent = masteredChars;
            document.getElementById('review-count').textContent = totalReviews;
        }

        // Utility functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
